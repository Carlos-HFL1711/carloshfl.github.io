<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Projeto 5 ‚Äî Relat√≥rios de M√°quinas (Aleat√≥rios, Sem Hist√≥rico)</title>
<style>
:root{
  --bg:#070b16; --fg:#eaf2ff; --muted:#9bb0d3;
  --surface:#0d1534; --surface2:#10183b; --surface3:#0f1a45;
  --brand:#7c4dff; --accent:#20d3ff; --ok:#19c37d; --warn:#ffd166; --bad:#ff6363;
  --radius:18px;
}
*{box-sizing:border-box}
html,body{height:100%}
html,body{margin:0; overflow-x:hidden}
body{
  color:var(--fg);
  font:15px ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background:
    radial-gradient(1200px 700px at 10% 10%, rgba(124,77,255,.18), transparent 60%),
    radial-gradient(900px 600px at 90% 90%, rgba(32,211,255,.12), transparent 60%),
    var(--bg);
}
.wrap{max-width:1200px; margin:0 auto; padding:16px 20px; overflow-x:clip}
h1{margin:.5rem 0 .3rem; font-size:clamp(26px,5vw,40px); line-height:1.05}
.p{color:var(--muted); margin:0}

/* header */
header{position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
  background:rgba(7,11,22,.6); border-bottom:1px solid rgba(255,255,255,.06)}
.head{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
.nav{display:flex; gap:8px; flex-wrap:wrap}
.link{display:inline-flex; gap:8px; align-items:center; padding:10px 14px; border-radius:999px; font-weight:800; color:#0a0f20; text-decoration:none; background:linear-gradient(90deg, var(--brand), var(--accent)); box-shadow:0 10px 24px rgba(124,77,255,.35)}
.link.ghost{background:#22306a; color:#eaf2ff}

/* toolbar */
.toolbar{display:grid; grid-template-columns: 1.2fr 1fr; gap:12px; margin-top:12px}
@media (max-width:1000px){ .toolbar{grid-template-columns:1fr} }
.box{background:var(--surface2); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:14px; max-width:100%}
.box h3{margin:0 0 6px}
.controls{display:grid; grid-template-columns: repeat(4, minmax(120px,1fr)); gap:10px}
@media (max-width:840px){ .controls{grid-template-columns:1fr 1fr} }
/* üîß filhos de grid/flex podem estourar. for√ßa encolhimento: */
.controls > *, .row > *, .head > *, .toolbar > *, .kpis > *, .table, .card {min-width:0; max-width:100%}

input[type=number], input[type=text], select, .btn{
  background:var(--surface); border:1px solid rgba(255,255,255,.1); color:var(--fg);
  padding:10px 12px; border-radius:12px; width:100%
}
.btn{display:inline-flex; align-items:center; justify-content:center; font-weight:800; color:#0a0f20; background:linear-gradient(90deg, var(--brand), var(--accent)); cursor:pointer}
.btn.ghost{color:#cfe0ff; background:#152057}
.btn.small{padding:8px 10px; font-size:.92rem}
.row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}

/* chips filtros */
.filters{display:flex; gap:8px; flex-wrap:wrap}
.chip{display:inline-flex; gap:8px; align-items:center; cursor:pointer; user-select:none; background:#0f1a45; padding:8px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.08)}
.chip input{appearance:none; width:18px; height:18px; border-radius:4px; border:1px solid #3a4682}
.chip input:checked{background:linear-gradient(90deg, var(--brand), var(--accent)); border-color:transparent}

/* kpis */
.kpis{display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px; margin-top:12px}
@media (max-width:920px){ .kpis{grid-template-columns:1fr 1fr} }
.card{background:var(--surface); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px}
.card h4{margin:0 0 4px; color:#cfe0ff}
.k{font:700 26px/1 ui-sans-serif, system-ui}
.tag{font-size:12px; opacity:.85}

/* term */
.term{font:13px ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#0b122e; color:#cfe0ff;
  border:1px solid rgba(255,255,255,.1); border-radius:12px; padding:10px; height:200px; overflow:auto}
.line{white-space:pre}

/* tabela */
.table{background:var(--surface); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:8px; margin-top:12px; max-width:100%}
.table h3{margin:6px 8px}
.table .scroll{overflow:auto; -webkit-overflow-scrolling:touch}
table{width:100%; border-collapse:collapse; table-layout:fixed}
th,td{
  padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.06);
  text-align:left; vertical-align:top; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
th:nth-child(4), td:nth-child(4){ white-space:normal; overflow:visible; text-overflow:clip; word-break:break-word; }
th{position:sticky; top:0; background:var(--surface3)}
.badge{font-size:12px; padding:4px 8px; border-radius:999px; background:#111b45; border:1px solid rgba(255,255,255,.1)}
.badge.info{background:#132a47}
.badge.warn{background:#3b2d10}
.badge.crit{background:#3b1010}
.badge.dot{display:inline-block; width:8px; height:8px; border-radius:50%; margin-right:6px}
.color-ok{background:var(--ok)} .color-warn{background:var(--warn)} .color-bad{background:var(--bad)}

/* reveal */
.reveal{opacity:0; transform: translateY(18px); transition:.6s ease}
.reveal.on{opacity:1; transform:none}
@media (prefers-reduced-motion: reduce){ .reveal{transition:none} }

/* =============== FX LABS (6 containers) =============== */
.fx-grid{display:grid; gap:12px; grid-template-columns:repeat(2,minmax(0,1fr)); margin-top:14px}
@media (max-width:980px){ .fx-grid{grid-template-columns:1fr} }
.fx-card{position:relative; border:1px solid rgba(255,255,255,.08); border-radius:16px; overflow:hidden; background:var(--surface2)}
.fx-head{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.08)}
.fx-body{position:relative; min-height:240px; background:var(--surface)}
.fx-body canvas{display:block; width:100%; height:100%}
.fx-foot{display:flex; gap:8px; padding:10px 12px; border-top:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg, rgba(124,77,255,.06), transparent)}
.fx-cmd{margin:12px}
.cmd{background:#000; color:#cfe0ff; border-radius:12px; border:1px solid rgba(255,255,255,.12); overflow:hidden; position:relative; box-shadow:0 10px 28px rgba(0,0,0,.35)}
.cmd-head{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.08)}
.cmd-body{max-height:220px; overflow:auto; padding:10px; font:13px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
.cmd-controls{display:flex; gap:10px; padding:10px 12px; border-top:1px solid rgba(255,255,255,.08)}

/* ML bot overlay */
.ml-bot{position:absolute; right:12px; bottom:10px; width:120px; opacity:.9; pointer-events:none}
.gear{transform-origin:50% 50%; animation:spin 6s linear infinite}
.gear.small{animation-duration:4s}
@keyframes spin{to{transform:rotate(360deg)}}

/* Assembly belt */
.belt{position:absolute; left:0; right:0; bottom:26px; height:36px; border-top:1px solid rgba(255,255,255,.1); border-bottom:1px solid rgba(255,255,255,.1);
 background:repeating-linear-gradient(90deg, rgba(255,255,255,.12) 0 6px, transparent 6px 18px)}
.belt.move{animation:beltMove 1.6s linear infinite}
@keyframes beltMove{from{background-position:0 0} to{background-position:-200px 0}}
.boxA,.boxB,.boxC{position:absolute; bottom:36px; width:48px; height:36px; border-radius:8px; background:linear-gradient(180deg,#2a3a86,#1a255e); border:1px solid rgba(255,255,255,.12); box-shadow:0 10px 20px rgba(0,0,0,.3)}
.boxA{animation:bx1 7s linear infinite} .boxB{animation:bx2 7s linear infinite 1.8s} .boxC{animation:bx3 7s linear infinite 3.6s}
@keyframes bx1{0%{left:-60px}100%{left:calc(100% + 60px)}}
@keyframes bx2{0%{left:-60px}100%{left:calc(100% + 60px)}}
@keyframes bx3{0%{left:-60px}100%{left:calc(100% + 60px)}}
.armPick{position:absolute; left:20%; top:10px; width:140px; height:8px; background:#2b3777; border-radius:6px; transform-origin:0 50%; animation:armWave 2.4s ease-in-out infinite}
.claw{position:absolute; right:-10px; top:-6px; width:0; height:0; border-left:14px solid #20d3ff; border-top:10px solid transparent; border-bottom:10px solid transparent; filter:drop-shadow(0 0 8px rgba(32,211,255,.5))}
@keyframes armWave{0%,100%{transform:rotate(6deg)}50%{transform:rotate(-10deg)}}

/* AGV grid */
.agv-overlay{position:absolute; inset:0; pointer-events:none}

/* Heatmap legend */
.legend{position:absolute; right:10px; top:10px; background:rgba(0,0,0,.35); padding:6px 8px; border-radius:10px; font-size:12px; border:1px solid rgba(255,255,255,.12)}
</style>
</head>
<body>
<header>
  <div class="wrap head">
    <strong>Suas hist√≥rias com o seus <i>Controles</i> ‚Äî IOT+(APIs & BOTs)</strong>
    <nav class="nav">
      <a class="link" href="projetos.html">‚Üê Voltar</a>
      <a class="link ghost" href="subcard4.5.html">Relat√≥rios CFTV</a>
      <a class="link ghost" href="portfolio.html" title="(Portf√≥lio)">(Portf√≥lio)</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <h1>Relat√≥rios de M√°quinas</h1>
  <p class="p">Relat√≥rios de M√°quinas e CFTV com nossas APIs e sistematicas (BOTs). Mensagens de funcionamento 100% autom√°ticas e Registrada na sua Maquina 24H, <i>(Veja mais)</i>.</p>

  <!-- TOOLBAR -->
  <section class="toolbar reveal" id="top">
    <div class="box">
      <h3>Configura√ß√£o</h3>
      <div class="controls">
        <select id="empresa"></select>
        <select id="tipoMaquina"></select>
        <input id="qtdBots" type="number" min="1" max="50" value="8" title="Quantidade de bots simulados" />
        <input id="maxRows" type="number" min="50" max="10000" value="500" title="Limite de linhas no relat√≥rio" />
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="gen50">Gerar 50 agora</button>
        <button class="btn" id="autoOn">‚ñ∂ Auto</button>
        <select id="freq">
          <option value="500">a cada 0.5s</option>
          <option value="1000" selected>a cada 1s</option>
          <option value="2000">a cada 2s</option>
          <option value="5000">a cada 5s</option>
        </select>
        <button class="btn ghost" id="autoOff" disabled>‚èπ Parar</button>
        <input id="busca" type="text" placeholder="Buscar (empresa, m√°quina, mensagem)" style="flex:1;min-width:200px">
        <button class="btn ghost" id="limpar">Limpar</button>
      </div>
    </div>

    <div class="box">
      <h3>Filtros</h3>
      <div class="filters" id="filters">
        <label class="chip"><input type="checkbox" data-sev="info"> Info</label>
        <label class="chip"><input type="checkbox" data-sev="alerta"> Alerta</label>
        <label class="chip"><input type="checkbox" data-sev="critico"> Cr√≠tico</label>
      </div>
      <p class="p" style="margin-top:8px">Mensagens recentes:</p>
      <div id="term" class="term" aria-live="polite"></div>
    </div>
  </section>

  <!-- KPIs -->
  <section class="kpis reveal" id="kpis">
    <div class="card"><h4>Total</h4><div class="k" id="k-total">0</div><div class="tag">linhas exibidas (tempor√°rio)</div></div>
    <div class="card"><h4>Alertas</h4><div class="k" id="k-alerta">0</div><div class="tag">inclui humano/ve√≠culo</div></div>
    <div class="card"><h4>Cr√≠ticos</h4><div class="k" id="k-crit">0</div><div class="tag">fuma√ßa, intrus√£o, energia‚Ä¶</div></div>
    <div class="card"><h4>Top empresa</h4><div class="k" id="k-top">‚Äî</div><div class="tag">mais eventos gerados</div></div>
  </section>

  <!-- TABELA -->
  <section class="table reveal">
    <h3>Relat√≥rios deste site (tempor√°rios)</h3>
    <div class="scroll">
      <table id="tbl">
        <thead>
          <tr>
            <th>Data/Hora</th>
            <th>Empresa</th>
            <th>M√°quina</th>
            <th>Mensagem</th>
            <th>Severidade</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- =============== FX LABS: 6 containers com CMDs =============== -->
  <section class="reveal">
    <h3 style="margin:14px 0 8px">Opera√ß√µes Visuais ‚Äî Labs</h3>
    <div class="fx-grid">
      <!-- 1) ML RoboLearner -->
      <article class="fx-card" id="card-ml">
        <div class="fx-head"><b>Treinamento ML ‚Äî RoboLearner</b><span class="badge info">online</span></div>
        <div class="fx-body">
          <canvas id="cv-ml"></canvas>
          <svg class="ml-bot" viewBox="0 0 120 120" aria-hidden="true">
            <defs><linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#7c4dff"/><stop offset="100%" stop-color="#20d3ff"/></linearGradient></defs>
            <rect x="20" y="40" width="80" height="52" rx="10" fill="#0f1740" stroke="url(#g1)"/>
            <rect x="32" y="22" width="56" height="24" rx="8" fill="#0f1740" stroke="url(#g1)"/>
            <circle cx="60" cy="16" r="4" fill="url(#g1)"/>
            <circle cx="48" cy="34" r="4" fill="#cfe0ff"/><circle cx="72" cy="34" r="4" fill="#cfe0ff"/>
            <g class="gear"><circle cx="38" cy="86" r="10" fill="none" stroke="#20d3ff"/><path d="M38 78 v-4 M38 98 v4 M30 86 h-4 M50 86 h4 M32 80 l-3-3 M44 92 l3 3 M32 92 l-3 3 M44 80 l3-3" stroke="#20d3ff"/></g>
            <g class="gear small" style="transform-origin:78px 88px"><circle cx="78" cy="88" r="8" fill="none" stroke="#7c4dff"/><path d="M78 81 v-3 M78 95 v3 M71 88 h-3 M89 88 h3" stroke="#7c4dff"/></g>
          </svg>
        </div>
        <div class="fx-foot"><button class="btn small" data-toggle="cmd-ml">Abrir CMD</button></div>
        <div class="fx-cmd cmd" id="cmd-ml" hidden>
          <div class="cmd-head"><b>ml-train</b></div>
          <div class="cmd-body" id="ml-body"></div>
          <div class="cmd-controls"><button class="btn small" id="ml-pause">‚è∏Ô∏è Pausar</button><button class="btn small" id="ml-clear">üßπ Limpar</button></div>
        </div>
      </article>

      <!-- 2) Linha de Montagem (Assembly) -->
      <article class="fx-card" id="card-asm">
        <div class="fx-head"><b>Linha de Montagem ‚Äî Rob√¥s</b><span class="badge info">turno A</span></div>
        <div class="fx-body">
          <div class="armPick"><div class="claw"></div></div>
          <div class="belt move"></div>
          <div class="boxA"></div><div class="boxB"></div><div class="boxC"></div>
        </div>
        <div class="fx-foot"><button class="btn small" data-toggle="cmd-asm">Abrir CMD</button></div>
        <div class="fx-cmd cmd" id="cmd-asm" hidden>
          <div class="cmd-head"><b>assembly-run</b></div>
          <div class="cmd-body" id="asm-body"></div>
          <div class="cmd-controls"><button class="btn small" id="asm-pause">‚è∏Ô∏è Pausar</button><button class="btn small" id="asm-clear">üßπ Limpar</button></div>
        </div>
      </article>

      <!-- 3) Analisador de Vibra√ß√£o -->
      <article class="fx-card" id="card-vib">
        <div class="fx-head"><b>Analisador de Vibra√ß√£o ‚Äî Eixo/Mancal</b><span class="badge warn">monitorando</span></div>
        <div class="fx-body"><canvas id="cv-vib"></canvas></div>
        <div class="fx-foot"><button class="btn small" data-toggle="cmd-vib">Abrir CMD</button></div>
        <div class="fx-cmd cmd" id="cmd-vib" hidden>
          <div class="cmd-head"><b>vibe-scan</b></div>
          <div class="cmd-body" id="vib-body"></div>
          <div class="cmd-controls"><button class="btn small" id="vib-pause">‚è∏Ô∏è Pausar</button><button class="btn small" id="vib-clear">üßπ Limpar</button></div>
        </div>
      </article>

      <!-- 4) Frota AGV (rob√¥s m√≥veis) -->
      <article class="fx-card" id="card-agv">
        <div class="fx-head"><b>Frota AGV ‚Äî Rotas & Dock</b><span class="badge info">3 docas</span></div>
        <div class="fx-body">
          <canvas id="cv-agv"></canvas>
          <div class="agv-overlay legend">üü¢ livre ‚Ä¢ üü° carregando ‚Ä¢ üî¥ bloqueio</div>
        </div>
        <div class="fx-foot"><button class="btn small" data-toggle="cmd-agv">Abrir CMD</button></div>
        <div class="fx-cmd cmd" id="cmd-agv" hidden>
          <div class="cmd-head"><b>agv-fleet</b></div>
          <div class="cmd-body" id="agv-body"></div>
          <div class="cmd-controls"><button class="btn small" id="agv-pause">‚è∏Ô∏è Pausar</button><button class="btn small" id="agv-clear">üßπ Limpar</button></div>
        </div>
      </article>

      <!-- 5) Heatmap T√©rmico -->
      <article class="fx-card" id="card-heat">
        <div class="fx-head"><b>Monitor T√©rmico ‚Äî Heatmap</b><span class="badge info">calibra√ß√£o</span></div>
        <div class="fx-body">
          <canvas id="cv-heat"></canvas>
          <div class="legend">¬∞C ‚Ä¢ azul=frio ‚Ä¢ roxo=alto</div>
        </div>
        <div class="fx-foot"><button class="btn small" data-toggle="cmd-heat">Abrir CMD</button></div>
        <div class="fx-cmd cmd" id="cmd-heat" hidden>
          <div class="cmd-head"><b>thermal-watch</b></div>
          <div class="cmd-body" id="heat-body"></div>
          <div class="cmd-controls"><button class="btn small" id="heat-pause">‚è∏Ô∏è Pausar</button><button class="btn small" id="heat-clear">üßπ Limpar</button></div>
        </div>
      </article>

      <!-- 6) Telemetria de Rede -->
      <article class="fx-card" id="card-net">
        <div class="fx-head"><b>Telemetria de Rede ‚Äî Pulsos</b><span class="badge info">links L2/L3</span></div>
        <div class="fx-body"><canvas id="cv-net"></canvas></div>
        <div class="fx-foot"><button class="btn small" data-toggle="cmd-net2">Abrir CMD</button></div>
        <div class="fx-cmd cmd" id="cmd-net2" hidden>
          <div class="cmd-head"><b>net-telemetry</b></div>
          <div class="cmd-body" id="net2-body"></div>
          <div class="cmd-controls"><button class="btn small" id="net2-pause">‚è∏Ô∏è Pausar</button><button class="btn small" id="net2-clear">üßπ Limpar</button></div>
        </div>
      </article>
    </div>
  </section>
</main>

<script>
/* ========================= Random utils ========================= */
function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a }
function choice(arr){ return arr[Math.floor(Math.random()*arr.length)] }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function uniqPush(set, v){ if(!set.has(v)){ set.add(v); return true; } return false; }

/* ========================= Geradores de empresas (20% espec√≠ficas / 80% gen√©ricas) ========================= */
const INTL_SPECIFIC = ["Aquila Robotics","Orion Dynamics","NovaTek Global","Helios Automation","Zenith Systems","Arcadia Industrial","Atlas Robotics Group","Nimbus Analytics","Vanguard Mechatronics","Quantum Forge"];
const BR_SPECIFIC   = ["Auto Pe√ßas Dois Irm√£os","Posto S√£o Pedro","Metal√∫rgica Santa Luzia","Supermercado Estrela","Transportes Nova Era","Mec√¢nica Bom Jesus","Frigor√≠fico Boa Vista","Serralheria Uni√£o","Panificadora P√£o de Ouro","Constru√ß√µes Vale Verde","Distribuidora Primavera","Madeireira Lago Azul","Fazenda Monte Verde","Cooperativa S√£o Jos√©","Cer√¢mica Ouro Branco","Oficina Serra Dourada","Gr√°fica Horizonte","Tecno Ip√™","Bebidas Diamante","Comercial Aurora"];
const INTL_WORD_A = ["Aurelia","Nordex","Stellar","Vector","Polar","Nexon","Kaito","Axiom","Vertex","Lumina","Argon","Cobalt","Draco","Eclipse","Frontier","Gaia","Hyperion","Ionis","Juno","Kronos","Lyra","Magellan","Neon","Orbis","Pulsar","Quantum","Radiant","Solace","Titan","Umbra","Vortex","Warden","Xenon","Yotta","Zenova"];
const INTL_WORD_B = ["Global","International","Dynamics","Automation","Industries","Systems","Robotics","Technologies","Works","Labs","Solutions","Holdings","Engineering","Logistics","Analytics","Security","Networks","Manufacturing"];
function genIntlName(){ const a=choice(INTL_WORD_A), b=choice(INTL_WORD_B); if(Math.random()<.4){ const mid=choice(["Pacific","Atlantic","Nordic","Europe","Americas","Asia","Africa","Andes","Baltic","Alpine"]); return `${a} ${mid} ${b}`;} return `${a} ${b}`;}
const BR_TIPO=["Auto Pe√ßas","Posto","Metal√∫rgica","Supermercado","Transportes","Mec√¢nica","Frigor√≠fico","Serralheria","Panificadora","Constru√ß√µes","Distribuidora","Madeireira","Fazenda","Cooperativa","Cer√¢mica","Oficina","Gr√°fica","Bebidas","Comercial","Tecno","Locadora","Farm√°cia","Lava R√°pido","Padaria","Pousada","Hotel","Marcenaria","Conveni√™ncia"];
const BR_LOCAL=["Dois Irm√£os","S√£o Pedro","Santa Luzia","Estrela","Nova Era","Bom Jesus","Boa Vista","Uni√£o","P√£o de Ouro","Vale Verde","Primavera","Lago Azul","Monte Verde","S√£o Jos√©","Ouro Branco","Serra Dourada","Horizonte","Ip√™","Diamante","Aurora","Planalto","Jardim","Itaipu","Cidade Alta","Morada Nova","Vila Nova","Centro","Chapad√£o","Floresta","Dom Bosco","Parque das √Åguas","Jardim Europa","Veneza","Itapo√°","Praia Grande","Campos Gerais"];
function genBRName(){ const tipo=choice(BR_TIPO), local=choice(BR_LOCAL); const suf=Math.random()<.3?choice(["Ltda.","ME","EIRELI"]):""; return `${tipo} ${local}${suf? " "+suf:""}`;}
function buildIntl(total=50){ const want=Math.round(total*0.20); const out=new Set(); shuffle(INTL_SPECIFIC.slice()).slice(0,want).forEach(n=>uniqPush(out,n)); while(out.size<total){ uniqPush(out, genIntlName()); } return shuffle([...out]); }
function buildBR(total=100){ const want=Math.round(total*0.20); const out=new Set(); shuffle(BR_SPECIFIC.slice()).slice(0,want).forEach(n=>uniqPush(out,n)); while(out.size<total){ uniqPush(out, genBRName()); } return shuffle([...out]); }
const EMPRESAS_INTL = buildIntl(50);
const EMPRESAS_BR   = buildBR(100);
const EMPRESAS = shuffle([...EMPRESAS_INTL, ...EMPRESAS_BR]);

/* ========================= Tipos e mensagens ========================= */
const TIPOS_MAQUINA = ["Bot de Automa√ß√£o","CNC","Esteira","Compressor","AGV (rob√¥ m√≥vel)","Bra√ßo Rob√≥tico","Forno Industrial","Drone de inspe√ß√£o","Sensor LiDAR","NVR"];
const MSGS = [
  {t:"Inicializa√ß√£o de Bot", s:"info", w:8},{t:"Bot pausado", s:"info", w:7},{t:"Finaliza√ß√£o de Bot", s:"info", w:5},
  {t:"Detec√ß√£o de movimento (humano)", s:"alerta", w:55},{t:"Detec√ß√£o de movimento (ve√≠culo)", s:"alerta", w:25},
  {t:"Detec√ß√£o de movimento (animal: p√°ssaro)", s:"alerta", w:8},{t:"Detec√ß√£o de movimento (animal: cachorro)", s:"alerta", w:6},
  {t:"Detec√ß√£o de movimento (animal: gato)", s:"alerta", w:5},{t:"Detec√ß√£o de movimento (inseto)", s:"info", w:4},
  {t:"Objeto abandonado detectado", s:"alerta", w:10},{t:"Porta aberta", s:"alerta", w:10},{t:"Porta fechada", s:"info", w:6},
  {t:"Cerca el√©trica disparada", s:"critico", w:9},{t:"Cerca el√©trica restabelecida", s:"info", w:5},{t:"Alarme disparado", s:"critico", w:9},
  {t:"Alarme silencioso ativado", s:"alerta", w:6},{t:"Firewall: tentativa de acesso", s:"alerta", w:7},{t:"Firewall: acesso bloqueado", s:"info", w:6},
  {t:"Perda de sinal da c√¢mera", s:"alerta", w:12},{t:"Reconex√£o de c√¢mera", s:"info", w:10},{t:"NVR reiniciado", s:"info", w:6},
  {t:"NVR: disco cheio", s:"alerta", w:6},{t:"NVR: disco trocado", s:"info", w:4},{t:"Atualiza√ß√£o de firmware iniciada", s:"info", w:5},
  {t:"Atualiza√ß√£o de firmware conclu√≠da", s:"info", w:7},{t:"CPU alta (servidor)", s:"alerta", w:7},{t:"CPU normalizada", s:"info", w:6},
  {t:"Temperatura alta (sensor)", s:"alerta", w:9},{t:"Temperatura normalizada", s:"info", w:7},{t:"Umidade fora do padr√£o", s:"alerta", w:6},
  {t:"Umidade normalizada", s:"info", w:5},{t:"Queda de energia", s:"critico", w:8},{t:"Retorno de energia", s:"info", w:8},
  {t:"Bateria de nobreak baixa", s:"alerta", w:6},{t:"Bateria carregada", s:"info", w:6},{t:"Rede inst√°vel (lat√™ncia)", s:"alerta", w:8},
  {t:"Rede normalizada", s:"info", w:7},{t:"Novo dispositivo cadastrado", s:"info", w:4},{t:"Dispositivo removido", s:"info", w:4},
  {t:"Acesso autorizado (biometria)", s:"info", w:6},{t:"Acesso negado (biometria)", s:"alerta", w:8},
  {t:"Reconhecimento facial positivo", s:"info", w:7},{t:"Reconhecimento facial inconclusivo", s:"alerta", w:5},
  {t:"QR code inv√°lido", s:"alerta", w:5},{t:"QR code validado", s:"info", w:5},{t:"Janela aberta", s:"alerta", w:5},{t:"Janela fechada", s:"info", w:5},
  {t:"Detec√ß√£o de fuma√ßa", s:"critico", w:7},{t:"Detec√ß√£o de vazamento", s:"critico", w:6},{t:"Sprinkler ativado", s:"critico", w:5},{t:"Sprinkler desativado", s:"info", w:5},
  {t:"Intrus√£o no per√≠metro", s:"critico", w:7},{t:"Intrus√£o descartada (falso positivo)", s:"info", w:4},{t:"Zona desativada", s:"info", w:4},{t:"Zona reativada", s:"info", w:4},
  {t:"Modo manuten√ß√£o habilitado", s:"info", w:5},{t:"Modo manuten√ß√£o finalizado", s:"info", w:5},{t:"Backup iniciado", s:"info", w:4},{t:"Backup conclu√≠do", s:"info", w:4},
  {t:"Licen√ßa expirada", s:"alerta", w:4},{t:"Licen√ßa renovada", s:"info", w:4},{t:"API externa indispon√≠vel", s:"alerta", w:5},{t:"API externa normalizada", s:"info", w:5},
  {t:"Webhook entregue", s:"info", w:6},{t:"Webhook com erro", s:"alerta", w:5},{t:"Sensor desconectado", s:"alerta", w:7},{t:"Sensor reconectado", s:"info", w:7},
  {t:"Esteira parada", s:"alerta", w:6},{t:"Esteira retomada", s:"info", w:6},{t:"Compressor ligado", s:"info", w:5},{t:"Compressor desligado", s:"info", w:5},
  {t:"Rob√¥ industrial calibrado", s:"info", w:4},{t:"Rob√¥ industrial: erro de eixo", s:"critico", w:5},{t:"C√¢mera obstru√≠da", s:"alerta", w:8},{t:"C√¢mera limpa", s:"info", w:6}
];

/* ========================= Estado e helpers UI ========================= */
let rows = []; let autoTimer = null;
const $ = (s)=>document.querySelector(s);
function log(msg){ const term=$('#term'); const h=new Date().toTimeString().slice(0,8); const div=document.createElement('div'); div.className='line'; div.textContent=`${h}  ${msg}`; term.appendChild(div); term.scrollTop=term.scrollHeight; }
function pad2(n){ return String(n).padStart(2,'0') }
const totalWeight = MSGS.reduce((sum,m)=>sum+m.w,0);
function pickMsg(){ let r=Math.random()*totalWeight, acc=0; for(const m of MSGS){ acc+=m.w; if(r<=acc) return m; } return MSGS[0]; }

/* ========================= UI init ========================= */
function fillSelects(){
  $('#empresa').innerHTML = `<option value="">Empresa (aleat√≥ria)</option>` + EMPRESAS.map(e=>`<option>${e}</option>`).join('');
  $('#tipoMaquina').innerHTML = `<option value="">Tipo de m√°quina (aleat√≥ria)</option>` + TIPOS_MAQUINA.map(e=>`<option>${e}</option>`).join('');
}
fillSelects();

/* ========================= Gerador/Render do relat√≥rio ========================= */
function genRow(){
  const empresa = $('#empresa').value || choice(EMPRESAS);
  const tipo    = $('#tipoMaquina').value || choice(TIPOS_MAQUINA);
  const botId   = randInt(1,999);
  const maquina = `${tipo} ‚Ä¢ Bot (${botId})`;
  const msg     = pickMsg();
  const now     = new Date();
  const ts = `${pad2(now.getDate())}/${pad2(now.getMonth()+1)}/${now.getFullYear()} ${pad2(now.getHours())}:${pad2(now.getMinutes())}:${pad2(now.getSeconds())}`;
  return { ts, empresa, maquina, msg: msg.t, sev: msg.s };
}
function sevBadge(sev){
  if(sev==='critico') return `<span class="badge crit"><span class="badge dot color-bad"></span>Cr√≠tico</span>`;
  if(sev==='alerta')  return `<span class="badge warn"><span class="badge dot color-warn"></span>Alerta</span>`;
  return `<span class="badge info"><span class="badge dot color-ok"></span>Info</span>`;
}
function matchesFilters(r){
  const q = $('#busca').value.trim().toLowerCase();
  const sels = Array.from(document.querySelectorAll('#filters input:checked')).map(i=>i.dataset.sev);
  const sevOK = sels.length? sels.includes(r.sev): true;
  const qOK = !q || `${r.empresa} ${r.maquina} ${r.msg}`.toLowerCase().includes(q);
  return sevOK && qOK;
}
function render(){
  const maxRows = Math.max(50, Math.min(10000, +$('#maxRows').value||500));
  if(rows.length>maxRows) rows = rows.slice(0, maxRows);
  const tbody = $('#tbl tbody');
  const data = rows.filter(matchesFilters);
  tbody.innerHTML = data.map(r=>`
    <tr>
      <td>${r.ts}</td>
      <td>${r.empresa}</td>
      <td>${r.maquina}</td>
      <td>${r.msg}</td>
      <td>${sevBadge(r.sev)}</td>
    </tr>
  `).join('');
  // KPIs
  $('#k-total').textContent  = rows.length;
  const a = rows.filter(x=>x.sev==='alerta').length;
  const c = rows.filter(x=>x.sev==='critico').length;
  $('#k-alerta').textContent = a; $('#k-crit').textContent = c;
  const top = rows.reduce((acc,r)=>{acc[r.empresa]=(acc[r.empresa]||0)+1; return acc;},{});
  const topKey = Object.keys(top).sort((x,y)=>top[y]-top[x])[0] || '‚Äî';
  $('#k-top').textContent = topKey;
}

/* ========================= A√ß√µes toolbar ========================= */
function addOne(){
  const qtd = Math.max(1, Math.min(50, +$('#qtdBots').value||8));
  const pool = shuffle(EMPRESAS.slice()).slice(0, Math.min(qtd, EMPRESAS.length));
  const row = genRow(); row.empresa = $('#empresa').value ? row.empresa : choice(pool);
  rows.unshift(row); log(`${row.empresa} ‚Ä¢ ${row.maquina} ‚Üí ${row.msg}`); render();
}
function addMany(n=50){ for(let i=0;i<n;i++) addOne(); }
$('#gen50').onclick = ()=> addMany(50);
$('#autoOn').onclick = ()=>{
  if(autoTimer) return;
  $('#autoOn').disabled=true; $('#autoOff').disabled=false;
  const freq= +$('#freq').value || 1000;
  autoTimer = setInterval(addOne, freq);
  log(`Auto ligado (freq=${freq}ms)`);
};
$('#autoOff').onclick = ()=>{ clearInterval(autoTimer); autoTimer=null; $('#autoOn').disabled=false; $('#autoOff').disabled=true; log('Auto pausado'); };
$('#limpar').onclick = ()=>{ rows=[]; render(); $('#term').innerHTML=''; log('Limpeza conclu√≠da (sem hist√≥rico)'); };
$('#filters').addEventListener('change', render);
$('#busca').addEventListener('input', render);
['empresa','tipoMaquina','qtdBots','maxRows','freq'].forEach(id=>$('#'+id).addEventListener('change', render));

/* ========================= Reveal ========================= */
const IO=new IntersectionObserver((ents)=>ents.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('on'); IO.unobserve(e.target);} }),{threshold:.12});
document.querySelectorAll('.reveal').forEach(el=> IO.observe(el));

/* ========================= ===== FX LABS logic ===== ========================= */

/* helpers vis */
function makeVisRunner(el, start, stop){
  const io = new IntersectionObserver(ents=>{
    ents.forEach(e=>{ if(e.isIntersecting) start(); else stop && stop(); });
  },{threshold:.2});
  io.observe(el);
}
function cmdLog(id, text){ const el=document.getElementById(id); const p=document.createElement('div'); const t=new Date().toTimeString().slice(0,8); p.textContent=`${t}  ${text}`; el.appendChild(p); el.scrollTop=el.scrollHeight; }

/* CMD toggles */
(function cmdToggles(){
  document.querySelectorAll('[data-toggle]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-toggle');
      const box = document.getElementById(id);
      const open = !box.hasAttribute('hidden');
      document.querySelectorAll('.fx-cmd').forEach(b=> b.setAttribute('hidden',''));
      if(!open) box.removeAttribute('hidden');
    });
  });
})();

/* 1) ML ‚Äî loss/acc charts + engrenagens */
(() => {
  const cv = document.getElementById('cv-ml'); if(!cv) return; const ctx=cv.getContext('2d');
  let run=false, raf=null; let t=0; let loss=1.0, acc=0.10, epoch=0;
  function size(){ cv.width=cv.clientWidth; cv.height=cv.clientHeight; } size(); addEventListener('resize', size);
  function draw(){
    const w=cv.width,h=cv.height; ctx.clearRect(0,0,w,h);
    // grid
    ctx.globalAlpha=.15; ctx.strokeStyle='#eaf2ff'; for(let i=0;i<=6;i++){ const y=i*h/6; ctx.beginPath(); ctx.moveTo(40,y); ctx.lineTo(w-10,y); ctx.stroke(); }
    ctx.globalAlpha=1;
    // axes
    ctx.strokeStyle='rgba(255,255,255,.35)'; ctx.beginPath(); ctx.moveTo(40,10); ctx.lineTo(40,h-30); ctx.lineTo(w-10,h-30); ctx.stroke();
    // loss descendo
    ctx.strokeStyle='#ff71c6'; ctx.beginPath();
    for(let x=40;x<w-10;x+=6){ const i=x-40; const y = h-30 - (Math.max(0.02,1/Math.pow(1+i/200,1.2)) * (h-60)); ctx.lineTo(x,y); }
    ctx.stroke();
    // acc subindo
    ctx.strokeStyle='#20d3ff'; ctx.beginPath();
    for(let x=40;x<w-10;x+=6){ const i=x-40; const y = h-30 - (Math.min(.98, (Math.log(1+i/120)/Math.log(10))) * (h-60)); ctx.lineTo(x,y); }
    ctx.stroke();
    // current point
    const px = 40 + (epoch%((w-60)/6))*6; const ly = h-30 - loss*(h-60); const ay = h-30 - acc*(h-60);
    ctx.fillStyle='#ff71c6'; ctx.beginPath(); ctx.arc(px, ly, 3, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle='#20d3ff'; ctx.beginPath(); ctx.arc(px, ay, 3, 0, Math.PI*2); ctx.fill();
    // labels
    ctx.fillStyle='#cfe0ff'; ctx.fillText(`epoch ${epoch}`, w-100, 20);
    ctx.fillText(`loss ${loss.toFixed(3)}`, w-140, 36);
    ctx.fillText(`acc ${(acc*100|0)}%`, w-120, 52);
  }
  function step(){
    if(!run) return;
    t+=0.02; epoch++;
    loss = Math.max(0.02, loss * (0.985 + Math.random()*0.004));
    acc  = Math.min(0.98, acc + 0.006 + Math.random()*0.004);
    if(epoch%25===0) cmdLog('ml-body', `epoch ${epoch} ‚Ä¢ loss=${loss.toFixed(3)} ‚Ä¢ acc=${(acc*100).toFixed(1)}% ‚Ä¢ checkpoint salvo ‚úÖ`);
    draw(); raf=requestAnimationFrame(step);
  }
  makeVisRunner(cv, ()=>{ if(!run){ run=true; step(); } }, ()=>{ run=false; cancelAnimationFrame(raf); });

  // CMD controls
  let paused=false; document.getElementById('ml-pause').onclick=()=>{ paused=!paused; document.getElementById('ml-pause').textContent=paused?'‚ñ∂Ô∏è Retomar':'‚è∏Ô∏è Pausar'; run=!paused; if(run) step(); };
  document.getElementById('ml-clear').onclick=()=>{ document.getElementById('ml-body').innerHTML=''; };
})();

/* 2) Assembly ‚Äî boxes + bra√ßo */
(() => {
  const body = document.getElementById('asm-body'); let stopped=false;
  setInterval(()=>{ if(stopped) return;
    const msgs=[
      ()=>`rob√¥ A posicionou m√≥dulo #${randInt(100,999)} na caixa`,
      ()=>`sensor √≥ptico OK ‚Ä¢ alinhamento ¬±${randInt(1,3)}mm`,
      ()=>`controle de qualidade: amostra L${randInt(10,99)} aprovada`,
      ()=>`esteira velocidade ${randInt(80,120)}% ‚Ä¢ torque nominal`,
      ()=>`troca r√°pida de garra conclu√≠da ‚Ä¢ 0${randInt(4,9)}s`
    ];
    cmdLog('asm-body', msgs[randInt(0,msgs.length-1)]() + ' ‚úÖ');
  }, 1200);
  document.getElementById('asm-pause').onclick=()=>{ stopped=!stopped; document.getElementById('asm-pause').textContent=stopped?'‚ñ∂Ô∏è Retomar':'‚è∏Ô∏è Pausar'; };
  document.getElementById('asm-clear').onclick=()=> body.innerHTML='';
})();

/* 3) Vibra√ß√£o ‚Äî oscilosc√≥pio */
(() => {
  const cv=document.getElementById('cv-vib'); if(!cv) return; const ctx=cv.getContext('2d'); let run=false, raf=null; let t=0;
  function size(){ cv.width=cv.clientWidth; cv.height=cv.clientHeight; } size(); addEventListener('resize', size);
  function tick(){
    if(!run) return;
    const w=cv.width,h=cv.height; ctx.fillStyle='rgba(13,21,52,.5)'; ctx.fillRect(0,0,w,h);
    // grid
    ctx.strokeStyle='rgba(255,255,255,.12)'; for(let y=0;y<h;y+=24){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }
    // wave
    ctx.strokeStyle='#7c4dff'; ctx.beginPath();
    for(let x=0;x<w;x++){
      const y=h/2 + Math.sin((x+t)/24)*26 + Math.sin((x+t)/7)*4;
      (x?ctx.lineTo(x,y):ctx.moveTo(x,y));
    } ctx.stroke();
    t+=2; raf=requestAnimationFrame(tick);
  }
  makeVisRunner(cv, ()=>{ if(!run){ run=true; tick(); } }, ()=>{ run=false; cancelAnimationFrame(raf); });
  // CMD
  let stopped=false; setInterval(()=>{ if(stopped) return;
    const rms=(0.15+Math.random()*0.25).toFixed(2); const pk=(0.8+Math.random()*0.6).toFixed(2);
    const st = rms<0.30? 'OK ‚úÖ' : 'aten√ß√£o ‚ö†Ô∏è';
    cmdLog('vib-body', `RMS=${rms}g ‚Ä¢ pico=${pk}g ‚Ä¢ eixo #${randInt(1,3)} ‚Ä¢ status ${st}`);
  }, 1500);
  document.getElementById('vib-pause').onclick=()=>{ stopped=!stopped; document.getElementById('vib-pause').textContent=stopped?'‚ñ∂Ô∏è Retomar':'‚è∏Ô∏è Pausar'; };
  document.getElementById('vib-clear').onclick=()=>{ document.getElementById('vib-body').innerHTML=''; };
})();

/* 4) AGV ‚Äî grid de rotas */
(() => {
  const cv=document.getElementById('cv-agv'); if(!cv) return; const ctx=cv.getContext('2d'); let run=false, raf=null;
  function size(){ cv.width=cv.clientWidth; cv.height=cv.clientHeight; } size(); addEventListener('resize', size);

  // cria 5 AGVs com caminhos retangulares diferentes
  const agvs = Array.from({length:5}).map((_,i)=>({
    id:i+1, x:40+ i*20, y:40, w:cv.width-80, h:cv.height-80, dir:0, s:1.5+Math.random()*1.2, state:'free'
  }));
  function step(){
    if(!run) return;
    const w=cv.width,h=cv.height; ctx.clearRect(0,0,w,h);
    // grid/obst
    ctx.fillStyle='#0c1536'; ctx.fillRect(0,0,w,h);
    ctx.strokeStyle='rgba(255,255,255,.08)'; for(let y=40;y<h-40;y+=40){ ctx.beginPath(); ctx.moveTo(40,y); ctx.lineTo(w-40,y); ctx.stroke(); }
    for(let x=40;x<w-40;x+=40){ ctx.beginPath(); ctx.moveTo(x,40); ctx.lineTo(x,h-40); ctx.stroke(); }
    // docks
    ctx.fillStyle='rgba(32,211,255,.18)'; ctx.fillRect(w-100, 50, 50, 30);
    ctx.fillRect(w-100, 100, 50, 30); ctx.fillRect(w-100, 150, 50, 30);
    // agvs
    agvs.forEach(a=>{
      // movimento ao redor do ret√¢ngulo
      if(a.dir===0){ a.x+=a.s; if(a.x> a.w) a.dir=1; }
      else if(a.dir===1){ a.y+=a.s; if(a.y> a.h) a.dir=2; }
      else if(a.dir===2){ a.x-=a.s; if(a.x< 40) a.dir=3; }
      else { a.y-=a.s; if(a.y< 40) a.dir=0; }
      // estados
      if(a.x>cv.width-120 && Math.random()<0.01){ a.state = a.state==='free' ? 'load' : 'free'; }
      const col = a.state==='free' ? '#20d3ff' : (a.state==='load' ? '#ffd166' : '#ff6363');
      ctx.fillStyle=col; ctx.beginPath(); ctx.arc(a.x,a.y,6,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='#cfe0ff'; ctx.font='bold 10px ui-sans-serif'; ctx.fillText('AGV'+a.id, a.x+8, a.y-8);
    });
    raf=requestAnimationFrame(step);
  }
  makeVisRunner(cv, ()=>{ if(!run){ run=true; step(); } }, ()=>{ run=false; cancelAnimationFrame(raf); });

  // CMD
  let stopped=false; setInterval(()=>{ if(stopped) return;
    const a=choice(agvs); const evt=Math.random();
    if(evt<.5) cmdLog('agv-body', `AGV${a.id} navegando ‚Üí waypoint (${a.x|0},${a.y|0})`);
    else if(evt<.8) cmdLog('agv-body', `AGV${a.id} carregamento na doca ${randInt(1,3)} ‚Ä¢ peso ${randInt(120,350)}kg`);
    else cmdLog('agv-body', `AGV${a.id} rota replanejada (bloqueio tempor√°rio)`);
  }, 1100);
  document.getElementById('agv-pause').onclick=()=>{ stopped=!stopped; document.getElementById('agv-pause').textContent=stopped?'‚ñ∂Ô∏è Retomar':'‚è∏Ô∏è Pausar'; };
  document.getElementById('agv-clear').onclick=()=>{ document.getElementById('agv-body').innerHTML=''; };
})();

/* 5) Heatmap t√©rmico */
(() => {
  const cv=document.getElementById('cv-heat'); if(!cv) return; const ctx=cv.getContext('2d'); let run=false, raf=null; let z=0;
  function size(){ cv.width=cv.clientWidth; cv.height=cv.clientHeight; } size(); addEventListener('resize', size);
  function color(t){ // t [0..1] -> azul -> roxo
    const r = 100 + Math.floor(80*t), g = 120-Math.floor(60*t), b = 200+Math.floor(30*(1-t));
    return `rgb(${r},${g},${b})`;
  }
  function tick(){
    if(!run) return; z+=0.02; const w=cv.width,h=cv.height; const cell=22;
    for(let y=0;y<h;y+=cell){
      for(let x=0;x<w;x+=cell){
        const v = (Math.sin((x+z*120)/180)+Math.cos((y+z*140)/160)+2)/4; // 0..1
        ctx.fillStyle=color(v); ctx.fillRect(x,y,cell,cell);
      }
    }
    raf=requestAnimationFrame(tick);
  }
  makeVisRunner(cv, ()=>{ if(!run){ run=true; tick(); } }, ()=>{ run=false; cancelAnimationFrame(raf); });
  // CMD
  let stopped=false; setInterval(()=>{ if(stopped) return;
    const zone = `Z${randInt(1,6)}-${randInt(1,6)}`; const temp=randInt(18,56);
    const fan = temp>40? randInt(70,100): (temp>30? randInt(40,70): randInt(10,40));
    const st = temp>48? '‚ö†Ô∏è pico' : 'OK';
    cmdLog('heat-body', `zona ${zone} ‚Ä¢ ${temp}¬∞C ‚Ä¢ fan ${fan}% ‚Ä¢ ${st}`);
  }, 1300);
  document.getElementById('heat-pause').onclick=()=>{ stopped=!stopped; document.getElementById('heat-pause').textContent=stopped?'‚ñ∂Ô∏è Retomar':'‚è∏Ô∏è Pausar'; };
  document.getElementById('heat-clear').onclick=()=>{ document.getElementById('heat-body').innerHTML=''; };
})();

/* 6) Telemetria de Rede ‚Äî part√≠culas em links */
(() => {
  const cv=document.getElementById('cv-net'); if(!cv) return; const ctx=cv.getContext('2d'); let run=false, raf=null; const nodes=[];
  function size(){ cv.width=cv.clientWidth; cv.height=cv.clientHeight; } size(); addEventListener('resize', size);
  // cria n√≥s fixos
  function setup(){
    nodes.length=0;
    const w=cv.width,h=cv.height;
    const pts=[[0.15,0.25],[0.35,0.18],[0.55,0.28],[0.75,0.22],[0.25,0.62],[0.45,0.55],[0.65,0.65],[0.82,0.58]];
    pts.forEach(p=> nodes.push({x:p[0]*w, y:p[1]*h}));
  }
  setup();
  const pulses = [];
  function emit(){ // lan√ßa um pulso em um link aleat√≥rio
    const a=choice(nodes), b=choice(nodes.filter(n=>n!==a));
    pulses.push({ax:a.x, ay:a.y, bx:b.x, by:b.y, t:0, sp:0.008+Math.random()*0.01});
  }
  function tick(){
    if(!run) return;
    const w=cv.width,h=cv.height; ctx.clearRect(0,0,w,h);
    // desenha links
    ctx.strokeStyle='rgba(137,201,255,.25)'; nodes.forEach(a=> nodes.forEach(b=>{
      if(a===b) return; const d=Math.hypot(a.x-b.x, a.y-b.y); if(d<260){ ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); }
    }));
    // n√≥s
    nodes.forEach(n=>{ ctx.fillStyle='rgba(124,77,255,.85)'; ctx.beginPath(); ctx.arc(n.x,n.y,4,0,Math.PI*2); ctx.fill(); });
    // pulsos
    for(let i=pulses.length-1;i>=0;i--){
      const p=pulses[i]; p.t+=p.sp;
      const x=p.ax + (p.bx-p.ax)*p.t; const y=p.ay + (p.by-p.ay)*p.t;
      ctx.fillStyle='#20d3ff'; ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
      if(p.t>=1){ pulses.splice(i,1); }
    }
    if(Math.random()<0.4) emit();
    raf=requestAnimationFrame(tick);
  }
  makeVisRunner(cv, ()=>{ if(!run){ run=true; tick(); } }, ()=>{ run=false; cancelAnimationFrame(raf); });

  // CMD
  let stopped=false; setInterval(()=>{ if(stopped) return;
    const rtt=randInt(12,180), loss=Math.random()<.85? randInt(0,2): randInt(3,8);
    const thr=randInt(80,940);
    cmdLog('net2-body', `RTT=${rtt}ms ‚Ä¢ perda=${loss}% ‚Ä¢ thput=${thr}Mbps ‚Ä¢ ${(loss<=2?'est√°vel ‚úÖ':'aten√ß√£o ‚ö†Ô∏è')}`);
  }, 1400);
  document.getElementById('net2-pause').onclick=()=>{ stopped=!stopped; document.getElementById('net2-pause').textContent=stopped?'‚ñ∂Ô∏è Retomar':'‚è∏Ô∏è Pausar'; };
  document.getElementById('net2-clear').onclick=()=>{ document.getElementById('net2-body').innerHTML=''; };
})();

/* ========================= Boot ========================= */
(function boot(){
  // iniciar com alguns registros
  for(let i=0;i<12;i++) addOne();
})();
</script>
</body>
</html>